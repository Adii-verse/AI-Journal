<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Motivational Journal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }
        .journal-card {
            background-color: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="text-gray-800 antialiased">

    <div class="container mx-auto max-w-3xl px-4 py-8 md:py-12">
        <header class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-bold text-gray-900 tracking-tight">AI Motivational Journal</h1>
            <p class="text-lg text-gray-600 mt-2">Your daily dose of AI-powered inspiration and reflection.</p>
        </header>

        <main>
            <!-- API Key Setup -->
            <div id="api-key-setup" class="hidden mb-8 p-6 rounded-2xl shadow-lg bg-yellow-100 border border-yellow-200">
                 <h2 class="text-xl font-semibold mb-3 text-yellow-800">Action Required: Add API Key</h2>
                 <p class="text-yellow-700 mb-4 text-sm">To generate journal entries, you need a free Google AI API Key. Your key will be saved securely in your browser.</p>
                 <div class="flex flex-col sm:flex-row gap-2">
                     <input type="password" id="api-key-input" placeholder="Paste your Google AI API Key here" class="flex-grow p-2 rounded-md border border-yellow-400 focus:ring-2 focus:ring-yellow-500 focus:outline-none">
                     <button id="save-api-key-btn" class="bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-2 px-4 rounded-md transition-colors">Save Key</button>
                 </div>
                 <p class="text-xs text-yellow-600 mt-2">
                    <a href="https://aistudio.google.com/app/apikey" target="_blank" class="underline hover:text-yellow-800">Click here to get your API key from Google AI Studio.</a>
                 </p>
            </div>

            <!-- AI Generation Section -->
            <div class="mb-8 p-6 rounded-2xl shadow-lg journal-card">
                <h2 class="text-2xl font-semibold mb-4 text-center">Today's Inspiration</h2>
                <div class="flex justify-center">
                    <button id="generate-btn" class="flex items-center justify-center bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-6 rounded-full transition-transform transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 shadow-md">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2 h-5 w-5"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"></path></svg>
                        <span>Get Today's Motivation</span>
                    </button>
                </div>
                
                <div id="loader" class="hidden justify-center my-4"><div class="loader"></div></div>

                <div id="generated-entry-container" class="hidden mt-6 p-5 bg-white/70 rounded-xl">
                    <p id="generated-text" class="text-gray-700 whitespace-pre-wrap"></p>
                    <div class="text-right mt-4">
                        <button id="save-btn" class="bg-emerald-500 hover:bg-emerald-600 text-white font-semibold py-2 px-5 rounded-lg transition-all shadow-sm">Save Entry</button>
                    </div>
                </div>
            </div>

            <!-- Saved Journal Entries -->
            <div class="p-6 rounded-2xl shadow-lg journal-card">
                <h2 class="text-2xl font-semibold mb-4 text-center border-b pb-3">My Journal</h2>
                <div id="journal-history" class="space-y-4">
                    <p id="empty-state" class="text-center text-gray-500 py-4">Your saved journal entries will appear here.</p>
                </div>
            </div>
        </main>
        
        <footer class="text-center mt-12 text-gray-500">
             <p>Powered by Generative AI</p>
        </footer>
    </div>

    <script type="module">
        // DOM Elements
        const generateBtn = document.getElementById('generate-btn');
        const loader = document.getElementById('loader');
        const generatedEntryContainer = document.getElementById('generated-entry-container');
        const generatedText = document.getElementById('generated-text');
        const saveBtn = document.getElementById('save-btn');
        const journalHistory = document.getElementById('journal-history');
        const emptyState = document.getElementById('empty-state');
        const apiKeySetup = document.getElementById('api-key-setup');
        const apiKeyInput = document.getElementById('api-key-input');
        const saveApiKeyBtn = document.getElementById('save-api-key-btn');
        
        // App State
        let currentGeneratedEntry = null;
        const API_KEY_STORAGE = 'AIzaSyD99erlbk1VUt4Q0xdVUN5gFd-NJUclke8';

        // --- App Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            checkApiKey();
            fetchAndRenderEntries();
        });

        function checkApiKey() {
            const apiKey = localStorage.getItem(API_KEY_STORAGE);
            if (!apiKey) {
                apiKeySetup.classList.remove('hidden');
                generateBtn.disabled = true;
                generateBtn.classList.add('opacity-50', 'cursor-not-allowed');
            } else {
                apiKeySetup.classList.add('hidden');
                generateBtn.disabled = false;
                generateBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            }
        }

        function saveApiKey() {
            const apiKey = apiKeyInput.value.trim();
            if (apiKey) {
                localStorage.setItem(API_KEY_STORAGE, apiKey);
                apiKeyInput.value = '';
                checkApiKey();
                alert('API Key saved successfully!');
            } else {
                alert('Please enter a valid API Key.');
            }
        }

        // --- AI Model Interaction ---
        async function generateJournalEntry() {
            const apiKey = localStorage.getItem(API_KEY_STORAGE);
            if (!apiKey) {
                alert("Please add your Google AI API Key first.");
                return;
            }

            generateBtn.disabled = true;
            generateBtn.classList.add('opacity-50', 'cursor-not-allowed');
            loader.classList.remove('hidden');
            loader.classList.add('flex');
            generatedEntryContainer.classList.add('hidden');

            const systemPrompt = "You are an inspiring and compassionate motivational coach. Your goal is to write a short, personal, and uplifting journal entry. Write in the first person (using 'I', 'my', 'me'). The entry should be reflective, positive, and end with a gentle, actionable piece of advice or a thought-provoking question for the day. Keep it concise, around 3-4 sentences.";
            const userQuery = "Write today's motivational journal entry for me.";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
            };

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`API call failed with status: ${response.status}. Please check if your API key is correct and valid.`);
                }

                const result = await response.json();
                const text = result.candidates?.[0]?.content?.parts?.[0]?.text;
                
                if (text) {
                    currentGeneratedEntry = text.trim();
                    generatedText.innerText = currentGeneratedEntry;
                    generatedEntryContainer.classList.remove('hidden');
                } else {
                    throw new Error("Invalid response structure from AI model.");
                }
            } catch (error) {
                console.error(`Error generating entry:`, error);
                generatedText.innerText = "Sorry, I couldn't generate an entry. Please check your API key and try again.";
                generatedEntryContainer.classList.remove('hidden');
            } finally {
                loader.classList.add('hidden');
                loader.classList.remove('flex');
                generateBtn.disabled = false;
                generateBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            }
        }

        // --- LocalStorage Database Functions ---
        function getEntriesFromStorage() {
            const entries = localStorage.getItem('journalEntries');
            return entries ? JSON.parse(entries) : [];
        }

        function saveEntriesToStorage(entries) {
            localStorage.setItem('journalEntries', JSON.stringify(entries));
        }

        function saveCurrentEntry() {
            if (!currentGeneratedEntry) return;

            saveBtn.disabled = true;
            saveBtn.innerText = "Saving...";
            
            const newEntry = {
                id: Date.now().toString(),
                text: currentGeneratedEntry,
                createdAt: new Date().toISOString()
            };

            const entries = getEntriesFromStorage();
            entries.push(newEntry);
            saveEntriesToStorage(entries);
            
            currentGeneratedEntry = null;
            generatedEntryContainer.classList.add('hidden');
            generatedText.innerText = "";
            
            saveBtn.disabled = false;
            saveBtn.innerText = "Save Entry";

            fetchAndRenderEntries();
        }

        function fetchAndRenderEntries() {
            const entries = getEntriesFromStorage();
            entries.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            renderEntries(entries);
        }
        
        function deleteEntry(id) {
            let entries = getEntriesFromStorage();
            entries = entries.filter(entry => entry.id !== id);
            saveEntriesToStorage(entries);
            fetchAndRenderEntries();
        }

        function renderEntries(entries) {
            journalHistory.innerHTML = '';

            if (entries.length === 0) {
                journalHistory.appendChild(emptyState);
            } else {
                if(emptyState.parentNode) emptyState.remove();
                entries.forEach(entry => {
                    const entryDiv = document.createElement('div');
                    entryDiv.className = 'relative bg-white/60 p-4 rounded-lg shadow-sm animate-fade-in';
                    entryDiv.dataset.id = entry.id;

                    const date = new Date(entry.createdAt).toLocaleDateString('en-US', {
                        year: 'numeric', month: 'long', day: 'numeric'
                    });

                    const dateP = document.createElement('p');
                    dateP.className = 'text-sm font-semibold text-gray-600 mb-2';
                    dateP.textContent = date;
                    
                    const textP = document.createElement('p');
                    textP.className = 'text-gray-800 pr-10';
                    textP.textContent = entry.text;
                    
                    const deleteBtn = document.createElement('button');
                    deleteBtn.innerHTML = '&times;';
                    deleteBtn.className = 'absolute top-2 right-2 text-xl text-gray-500 hover:text-red-500 font-bold w-8 h-8 flex items-center justify-center rounded-full hover:bg-red-100 transition-colors';
                    deleteBtn.title = "Delete entry";
                    deleteBtn.onclick = () => deleteEntry(entry.id);

                    entryDiv.appendChild(dateP);
                    entryDiv.appendChild(textP);
                    entryDiv.appendChild(deleteBtn);
                    journalHistory.appendChild(entryDiv);
                });
            }
        }

        // --- Event Listeners ---
        generateBtn.addEventListener('click', generateJournalEntry);
        saveBtn.addEventListener('click', saveCurrentEntry);
        saveApiKeyBtn.addEventListener('click', saveApiKey);
    </script>
</body>
</html>

